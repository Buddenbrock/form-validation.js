class FormValidation{constructor(options={}){this.form={formValidationClass:options.formValidationClass||"validate",filedInvalidClass:options.filedInvalidClass||"invalid",emailExp:options.emailExp||/^[^\s()<>@,;:\/]+@\w[\w.-]+\.[a-z]{2,}$/i,phoneExp:options.phoneExp||/^[0-9]{2,5}( )?([0-9]{4,9})$/i,passwordExp:options.passwordExp||/^0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+?><:{}[]$/i,passwordMinLen:options.passwordMinLen||6,passwordMaxLen:options.passwordMaxLen||20,recaptcha:options.recaptcha||true,recaptchaClass:options.recaptchaClass||".g-recaptcha"};if(document.querySelector("."+this.form.formValidationClass)){this.initValidation()}}initValidation=()=>{let inputEventListenerTypes=["blur","change","keyup"];this.form.element=document.querySelector("."+this.form.formValidationClass);this.form.inputs=this.form.element.querySelectorAll("input, textarea, select");this.getSubmitButton();this.form.element.addEventListener("submit",this.formSubmit.bind(this));if(this.form.recaptcha&&document.querySelector(this.form.recaptchaClass)){this.initializeRecaptcha()}Array.from(this.form.inputs).forEach(input=>{inputEventListenerTypes.forEach(type=>{input.addEventListener(type,this.validateOnChange.bind(this))})})};getSubmitButton=()=>{this.form.submitButton=this.form.element.querySelector('button[type="submit"]')};formSubmit=event=>{if(!this.validateFormData()){event.preventDefault();this.focusFirstErrorField()}};focusFirstErrorField=()=>{let formError=false;for(let i=0;i<this.form.inputs.length;i++){if(this.validateSingleInput(this.form.inputs[i])||formError){this.form.inputs[i].focus();break}}};validateFormData=()=>{let formError=false;Array.from(this.form.inputs).forEach(input=>{formError=this.validateSingleInput(input)||formError});return!formError};validateOnChange=event=>{this.validateSingleInput(event.target)};validateSingleInput=input=>{let rule=input.dataset["rule"],required=input.dataset["required"],exp,inputError=false;if(rule!==undefined){[rule,exp]=rule.split(":");switch(rule){case"required":inputError=this.ruleRequired(input,inputError);break;case"minlen":inputError=this.ruleMinLength(input,exp,inputError);break;case"email":inputError=this.ruleEmail(input,inputError);break;case"phone":inputError=this.rulePhone(input,inputError);break;case"checked":inputError=this.ruleChecked(input,inputError);break;case"radio":inputError=this.ruleRadio(input,inputError);break;case"selected":inputError=this.ruleSelected(input,inputError);break;case"regexp":inputError=this.ruleExp(input,exp,inputError);break;case"recaptcha":inputError=this.ruleRequired(input,inputError);break}if(inputError){this.showError(input)}else{this.hideError(input)}}return inputError};ruleRequired=(input,inputError)=>{if(input.value===""){inputError=true}return inputError};ruleMinLength=(input,exp,inputError)=>{if(input.value.length<parseInt(exp)){inputError=true}return inputError};ruleEmail=(input,inputError)=>{if(!this.form.emailExp.test(input.value)){inputError=true}return inputError};rulePhone=(input,inputError)=>{if(input.value.length>0&&!this.form.phoneExp.test(input.value)){inputError=true}return inputError};ruleChecked=(input,inputError)=>{if(!input.checked){inputError=true}return inputError};ruleRadio=(input,inputError)=>{let radioGroup=Array.from(document.querySelectorAll(`[name="${input.name}"]`));inputError=true;radioGroup.forEach(radio=>{if(radio.checked){inputError=false}});return inputError};ruleSelected=(input,inputError)=>{let value=input.options[input.selectedIndex].value;if(value===""){inputError=true}return inputError};ruleExp=(input,exp,inputError)=>{exp=new RegExp(exp);if(!exp.test(input.value)){inputError=true}return inputError};getFieldset=input=>{let fieldset=input.parentElement;console.log(fieldset);while(!fieldset.classList.contains("form-group")){fieldset=fieldset.parentElement}return fieldset};getError=fieldset=>{return fieldset.querySelector(".error")};createError=input=>{let error=document.createElement("div");error.className="error";error.setAttribute("role","alert");error.innerText=input.dataset["msg"]!==undefined?input.dataset["msg"]:"wrong Input";return error};insertError=(input,error)=>{let element=input,checkbox=input.dataset["rule"]==="checked",radio=input.dataset["rule"]==="radio",requiredBox=input.dataset["rule"]==="required",recaptcha=input.dataset["rule"]==="recaptcha";if(input.nextElementSibling){if(checkbox||radio){element=input.parentElement}else if(requiredBox||recaptcha){element=input.nextElementSibling}}this.insertAfter(error,element)};showError=input=>{let fieldset=this.getFieldset(input),error=this.getError(fieldset);this.addClassOnElement(fieldset,this.form.filedInvalidClass);if(error!==undefined&&error!==null){this.removeClassOnElement(error,"d-none")}else{error=this.createError(input);this.insertError(input,error)}};hideError=input=>{let fieldset=this.getFieldset(input),error=this.getError(fieldset);this.removeClassOnElement(fieldset,this.form.filedInvalidClass);if(error!==undefined&&error!==null){this.removeClassOnElement(error,"d-none");this.addClassOnElement(error,"d-none")}};initializeRecaptcha=()=>{window.grecaptcha.ready(()=>{this.recaptcha=this.form.element.querySelector(this.form.recaptchaClass);if(this.recaptcha){if(this.recaptcha.childElementCount===0){window.grecaptcha.render(this.recaptcha,this.recaptcha.dataset)}window.recaptchaCallback=this.setCaptchaValue.bind(this);window.recaptchaExpiredCallback=this.unsetCaptchaValue.bind(this)}})};setCaptchaValue=()=>{let input=this.getRecaptchaField();if(input){input.value="1"}this.validateSingleInput(input)};unsetCaptchaValue=()=>{let input=this.getRecaptchaField();if(input){input.value=""}this.validateSingleInput(input)};getRecaptchaField=()=>{let field,recaptchaElement=this.form.element.querySelector(this.form.recaptchaClass);if(recaptchaElement){field=document.getElementById(recaptchaElement.dataset["fieldId"])}return field};insertAfter(newNode,existingNode){existingNode.parentNode.append(newNode)}addClassOnElement=(element,classValue)=>{element.classList.add(classValue)};removeClassOnElement=(element,classValue)=>{element.classList.remove(classValue)}}